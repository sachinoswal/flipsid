<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlipSid - Trade Sports Cards with Friends</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%23ffd93d'/><text x='50' y='70' font-size='60' text-anchor='middle' fill='white'>‚öΩ</text></svg>">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #fff9e6 0%, #fffbf0 100%);
            min-height: 100vh;
        }

        header {
            background: linear-gradient(135deg, #ffd93d 0%, #ffaf00 100%);
            padding: 20px 0;
            box-shadow: 0 4px 15px rgba(255, 175, 0, 0.3);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .logo-text {
            font-size: 2em;
            font-weight: 900;
            color: white;
            text-transform: uppercase;
            font-family: 'Arial Black', sans-serif;
            letter-spacing: -1px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .nav-buttons button {
            background: white;
            color: #ffaf00;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
            transition: transform 0.2s;
        }

        .nav-buttons button:hover {
            transform: translateY(-2px);
        }

        .nav-buttons .btn-primary {
            background: linear-gradient(135deg, #ffd93d, #ffaf00);
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .auth-container {
            max-width: 450px;
            margin: 60px auto;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(255, 175, 0, 0.2);
            border: 3px solid #ffd93d;
        }

        .auth-container h2 {
            color: #ffaf00;
            margin-bottom: 30px;
            text-align: center;
            font-size: 2em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ffd93d;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #ffaf00;
        }

        .checkbox-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #ffd93d, #ffaf00);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 175, 0, 0.4);
        }

        .auth-switch {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }

        .auth-switch a {
            color: #ffaf00;
            text-decoration: none;
            font-weight: bold;
        }

        .pending-message {
            background: #fff9e6;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            border: 3px solid #ffd93d;
        }

        .pending-message h2 {
            color: #ffaf00;
            margin-bottom: 15px;
        }

        .pending-message p {
            color: #666;
            font-size: 1.1em;
        }

        .dashboard-header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(255, 175, 0, 0.1);
            border-left: 5px solid #ffd93d;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dashboard-header h1 {
            color: #ffaf00;
            margin-bottom: 10px;
        }

        .dashboard-header p {
            color: #666;
        }

        .flipcoins-badge {
            background: linear-gradient(135deg, #ffd93d, #ffaf00);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(255, 175, 0, 0.3);
        }

        .flipcoins-badge .amount {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }

        .flipcoins-badge .label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: white;
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(255, 175, 0, 0.1);
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 140px;
            padding: 15px;
            background: transparent;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            color: #666;
            transition: all 0.3s;
            text-align: center;
        }

        .tab.active {
            background: linear-gradient(135deg, #ffd93d, #ffaf00);
            color: white;
            border-color: #ffd93d;
        }

        .tab:hover:not(.active) {
            background: #fff9e6;
            border-color: #ffd93d;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .card-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(255, 175, 0, 0.15);
            border: 2px solid #ffd93d;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(255, 175, 0, 0.3);
        }

        .card-images {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .card-image {
            flex: 1;
            height: 180px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8em;
            overflow: hidden;
            border: 2px solid #ffd93d;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            cursor: pointer;
        }

        .card-image:hover {
            opacity: 0.9;
        }

        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-info {
            margin-top: 15px;
        }

        .card-info h3 {
            color: #ffaf00;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .card-detail {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 8px;
            background: #fff9e6;
            border-radius: 6px;
            font-size: 0.95em;
        }

        .card-detail strong {
            color: #666;
        }

        .card-detail span {
            color: #333;
            font-weight: 600;
        }

        .sport-badge {
            display: inline-block;
            padding: 4px 12px;
            background: linear-gradient(135deg, #ffd93d, #ffaf00);
            color: white;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .tags {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .tag {
            background: #e0e0e0;
            color: #333;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .tag.halloffame {
            background: #FFD700;
            color: #000;
        }

        .tag.rookie {
            background: #4CAF50;
            color: white;
        }

        .tag.limited {
            background: #f44336;
            color: white;
        }

        .card-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-small {
            flex: 1;
            min-width: 45%;
            padding: 10px;
            background: linear-gradient(135deg, #ffd93d, #ffaf00);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            font-size: 0.9em;
        }

        .btn-small:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: white;
            color: #ffaf00;
            border: 2px solid #ffd93d;
        }

        .btn-icon {
            padding: 8px 12px;
            font-size: 1.2em;
        }

        .btn-active {
            background: #4CAF50;
            border-color: #4CAF50;
        }

        .like-counter {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 10px;
            color: #ff4444;
            font-weight: bold;
        }

        .interaction-counters {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .interaction-counter {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: bold;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 6px;
            transition: background 0.2s;
            font-size: 0.9em;
        }

        .interaction-counter:hover {
            background: #fff9e6;
        }

        .interaction-counter.likes {
            color: #ff4444;
        }

        .interaction-counter.owns {
            color: #4CAF50;
        }

        .interaction-counter.wantsToBuy {
            color: #2196F3;
        }

        .interaction-counter.wantsToSell {
            color: #FF9800;
        }

        .user-list-item {
            padding: 15px;
            background: #fff9e6;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid #ffd93d;
        }

        .user-list-item strong {
            color: #ffaf00;
            font-size: 1.1em;
        }

        .follow-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #ffd93d, #ffaf00);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }

        .follow-btn:hover {
            transform: translateY(-2px);
        }

        .follow-btn.following {
            background: #4CAF50;
        }

        .btn-edit-card {
            background: #2196F3;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .file-upload {
            border: 2px dashed #ffd93d;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: background 0.3s;
            background: #fff9e6;
        }

        .file-upload:hover {
            background: #fff4d6;
        }

        .file-upload input {
            display: none;
        }

        .file-upload-text {
            color: #ffaf00;
            font-weight: bold;
            margin-top: 10px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 15px;
            border: 2px dashed #ffd93d;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            color: #ffaf00;
            margin-bottom: 10px;
        }

        .empty-state p {
            color: #666;
        }

        .hidden {
            display: none !important;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            font-weight: bold;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffaf00;
            font-weight: bold;
        }

        .user-avatar-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
        }

        .profile-pic-upload {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #ffd93d;
            margin: 0 auto 20px;
            display: block;
            cursor: pointer;
        }

        .profile-pic-placeholder {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            border: 3px dashed #ffd93d;
            cursor: pointer;
            font-size: 2em;
        }

        .card-id-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: bold;
        }

        .sport-icon {
            font-size: 1.2em;
        }

        .filter-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(255, 175, 0, 0.1);
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .filter-input {
            padding: 10px;
            border: 2px solid #ffd93d;
            border-radius: 8px;
            font-size: 0.95em;
        }

        .filter-input:focus {
            outline: none;
            border-color: #ffaf00;
        }

        .action-tags {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .action-tag {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .action-tag.liked {
            background: #ffebee;
            color: #ff4444;
        }

        .action-tag.owned {
            background: #e8f5e9;
            color: #4CAF50;
        }

        .action-tag.wanted {
            background: #e3f2fd;
            color: #2196F3;
        }

        .action-tag.selling {
            background: #fff3e0;
            color: #FF9800;
        }

        .tutorial-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }

        .tutorial-box h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .tutorial-box a {
            color: #1976d2;
            font-weight: bold;
        }

        .image-preview {
            width: 100%;
            max-width: 150px;
            height: 150px;
            border-radius: 8px;
            object-fit: cover;
            margin-top: 10px;
        }

        .preview-container {
            position: relative;
            display: inline-block;
        }

        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-weight: bold;
        }

        .admin-panel {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(255, 175, 0, 0.15);
            border: 2px solid #ff4444;
        }

        .admin-panel h3 {
            color: #ff4444;
            margin-bottom: 20px;
        }

        .pending-users, .pending-cards-list {
            display: grid;
            gap: 15px;
        }

        .pending-user, .pending-card {
            background: #fff9e6;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #ffd93d;
        }

        .pending-card {
            display: grid;
            grid-template-columns: 200px 1fr auto;
            gap: 20px;
            align-items: start;
        }

        .pending-user-info, .pending-card-info {
            flex: 1;
        }

        .pending-user-info strong, .pending-card-info strong {
            color: #ffaf00;
            font-size: 1.1em;
        }

        .pending-user-info p, .pending-card-info p {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .pending-user-actions, .pending-card-actions {
            display: flex;
            gap: 10px;
            flex-direction: column;
        }

        .btn-approve {
            background: #4CAF50;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-reject {
            background: #ff4444;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-edit {
            background: #2196F3;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .admin-badge {
            background: #ff4444;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 40px;
            color: white;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }

        .modal-close:hover {
            color: #ffd93d;
        }

        .edit-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .section-header {
            background: linear-gradient(135deg, #ffd93d, #ffaf00);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 30px 0 20px 0;
            font-size: 1.2em;
            font-weight: bold;
        }

        .section-header:first-child {
            margin-top: 0;
        }

        .uploader-badge {
            font-size: 0.85em;
            color: #999;
            margin-top: 5px;
        }

        .stats-badge {
            background: #e3f2fd;
            color: #1976d2;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 0.9em;
            display: inline-block;
            margin-top: 10px;
        }

        .notification-badge {
            background: #ff4444;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75em;
            margin-left: 5px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .card-title-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .card-title-row h3 {
            color: #ffaf00;
            font-size: 1.1em;
            margin: 0;
            flex: 1;
        }

        .card-title-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .heart-icon {
            font-size: 1.3em;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: transform 0.2s;
            user-select: none;
        }

        .heart-icon:hover {
            transform: scale(1.2);
        }

        .heart-icon.liked {
            animation: heartbeat 0.3s ease;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }

        .heart-count {
            font-size: 0.7em;
            color: #ff4444;
            font-weight: bold;
            cursor: pointer;
        }

        .heart-count:hover {
            text-decoration: underline;
        }

        /* Admin Page Styles */
        .admin-page {
            display: none;
        }

        .admin-page.active {
            display: block;
        }

        .admin-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: white;
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(255,0,0,0.1);
            border: 2px solid #ff4444;
            flex-wrap: wrap;
        }

        .admin-tab {
            flex: 1;
            min-width: 120px;
            padding: 12px;
            background: transparent;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            color: #666;
            text-align: center;
            transition: all 0.3s;
        }

        .admin-tab.active {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white;
            border-color: #ff4444;
        }

        .admin-tab:hover:not(.active) {
            background: #fff0f0;
            border-color: #ff4444;
        }

        .admin-tab-content {
            display: none;
        }

        .admin-tab-content.active {
            display: block;
        }

        .admin-header-btn {
            background: rgba(255,255,255,0.3);
            color: white;
            border: 2px solid white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
        }

        .admin-header-btn:hover {
            background: white;
            color: #ff4444;
        }

        .password-reset-form {
            background: #fff9e6;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ffd93d;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">‚öΩ</div>
                <div class="logo-text">FlipSid</div>
            </div>
            <div class="nav-buttons">
                <div id="userSection" class="hidden">
                    <span class="user-info">
                        <img id="userProfilePic" class="user-avatar-img" src="" alt="" style="display:none;">
                        <span class="user-avatar" id="userAvatar"></span>
                        <span id="userName"></span>
                        <span style="color: white; margin-left: 5px;">(üí∞ <span id="headerFlipcoins">0</span>)</span>
                        <span id="adminBadge" class="admin-badge hidden">ADMIN</span>
                    </span>
                    <button id="adminPageBtn" class="admin-header-btn hidden" onclick="showAdminPage()">‚öôÔ∏è Admin</button>
                    <button onclick="showEditProfile()" style="background:rgba(255,255,255,0.2); color:white; border:2px solid white; padding:8px 16px; border-radius:8px; font-weight:bold; cursor:pointer;">Edit Profile</button>
                    <button onclick="logout()" style="background:rgba(255,255,255,0.2); color:white; border:2px solid white; padding:8px 16px; border-radius:8px; font-weight:bold; cursor:pointer;">Logout</button>
                </div>
                <div id="authButtons">
                    <button onclick="showLogin()">Login</button>
                    <button class="btn-primary" onclick="showSignup()">Sign Up</button>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Login Form -->
        <div id="loginForm" class="auth-container hidden">
            <h2>Welcome Back! üëã</h2>
            <form onsubmit="login(event)">
                <div class="form-group">
                    <label>Nickname</label>
                    <input type="text" id="loginNickname" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <div style="position: relative;">
                        <input type="password" id="loginPassword" required style="padding-right: 45px;">
                        <button type="button" onclick="togglePasswordVisibility('loginPassword', 'loginEye')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 1.2em;">
                            <span id="loginEye">üëÅÔ∏è</span>
                        </button>
                    </div>
                </div>
                <button type="submit" class="btn">Login</button>
            </form>
            <div class="auth-switch">
                Don't have an account? <a href="#" onclick="showSignup()">Sign Up</a>
            </div>
        </div>

        <!-- Signup Form -->
        <div id="signupForm" class="auth-container hidden">
            <h2>Join FlipSid! üéâ</h2>
            <form onsubmit="signup(event)">
                <div class="form-group">
                    <label>Profile Picture</label>
                    <div class="profile-pic-placeholder" onclick="document.getElementById('signupProfilePic').click()">
                        üì∑
                    </div>
                    <input type="file" id="signupProfilePic" accept="image/*" style="display:none;" onchange="previewProfilePic(this, 'signupProfilePreview')">
                    <img id="signupProfilePreview" class="profile-pic-upload" style="display:none;">
                </div>
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="signupFullName" required placeholder="Your real name (kept private)">
                </div>
                <div class="form-group">
                    <label>Nickname</label>
                    <input type="text" id="signupNickname" required placeholder="e.g., CricketKing, FootyFan">
                </div>
                <div class="form-group">
                    <label>Mobile Number</label>
                    <input type="tel" id="signupPhone" required placeholder="Used for login (kept private)">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <div style="position: relative;">
                        <input type="password" id="signupPassword" required style="padding-right: 45px;">
                        <button type="button" onclick="togglePasswordVisibility('signupPassword', 'signupEye')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 1.2em;">
                            <span id="signupEye">üëÅÔ∏è</span>
                        </button>
                    </div>
                </div>
                <button type="submit" class="btn">Sign Up</button>
            </form>
            <div class="auth-switch">
                Already have an account? <a href="#" onclick="showLogin()">Login</a>
            </div>
        </div>

        <!-- Pending Approval -->
        <div id="pendingApproval" class="auth-container hidden">
            <div class="pending-message">
                <div style="font-size: 4em; margin-bottom: 20px;">‚è≥</div>
                <h2>Registration Pending</h2>
                <p>Thanks for signing up!</p>
                <div style="background: #fff9e6; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: left; border: 2px solid #ffd93d;">
                    <p style="color: #333; line-height: 1.6;">
                        Hello, I'm <strong>Sid</strong> and welcome to <strong>FlipSid</strong> (read as Flip Side). If you are here, you probably know me. This hobby project is a bridge between my passion for football, desire to pick new computer skills and an urge to earn some money :-). 
                        <br><br>
                        I built this under the strict supervision of my parents using AI tools like Claude. Since you are mostly not an adult like me, access to this website from your end should also be strictly under your parent's supervision. 
                        <br><br>
                        <strong>To approve your login please ask your parent to speak with my parents.</strong> This is to save all of us troublemakers more trouble. 
                        <br><br>
                        Thank you for your understanding. I hope to build a lot of things around sports so do share your feedback with me.
                        <br><br>
                        - Sid
                    </p>
                </div>
                <button class="btn" onclick="showLogin()" style="margin-top: 20px;">Back to Login</button>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="hidden">
            <!-- Tabs -->
            <div class="tabs">
                <div class="tab active" onclick="switchTab('browse')">üîç Browse Cards</div>
                <div class="tab" onclick="switchTab('upload')">üì§ Upload Cards</div>
                <div class="tab" onclick="switchTab('yourCards')">üíù Your Cards</div>
                <div class="tab" onclick="switchTab('friends')">üë• Your Friends<span id="friendRequestBadge" class="notification-badge" style="display:none;"></span></div>
            </div>

            <!-- Browse Cards Tab -->
            <div id="browseTab" class="tab-content active">
                <div class="filter-section">
                    <h3 style="color: #ffaf00; margin-bottom: 15px;">üîç Filter Cards</h3>
                    <div class="filter-row">
                        <input type="text" class="filter-input" id="searchText" placeholder="Search player name..." onkeyup="applyFilters()">
                        <select class="filter-input" id="filterTeam" onchange="applyFilters()">
                            <option value="">All Teams</option>
                        </select>
                        <select class="filter-input" id="filterType" onchange="applyFilters()">
                            <option value="">All Types</option>
                        </select>
                        <select class="filter-input" id="filterCompany" onchange="applyFilters()">
                            <option value="">All Companies</option>
                            <option value="Topps Match Attax">Topps Match Attax</option>
                            <option value="Premier League">Premier League</option>
                        </select>
                    </div>
                    <button class="btn-small" onclick="clearFilters()" style="width: auto;">Clear Filters</button>
                </div>
                <div id="browseCardsList" class="cards-grid"></div>
            </div>

            <!-- Upload Cards Tab -->
            <div id="uploadTab" class="tab-content">
                <div class="tutorial-box">
                    <h4>üì∫ How to Upload Cards</h4>
                    <p>Need help getting card images and data? <a href="https://www.youtube.com/results?search_query=how+to+photograph+trading+cards" target="_blank">Watch this tutorial</a> on how to photograph your trading cards properly.</p>
                    <p style="margin-top: 10px;"><strong>Tips:</strong> Use good lighting, keep the camera steady, and make sure the card fills most of the frame!</p>
                </div>
                <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(255, 175, 0, 0.15); border: 2px solid #ffd93d;">
                    <h3 style="color: #ffaf00; margin-bottom: 25px; font-size: 1.5em;">üì§ Upload New Card</h3>
                    <form onsubmit="uploadCard(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Card Front Picture</label>
                                <div class="file-upload" onclick="document.getElementById('uploadFrontImage').click()">
                                    <div style="font-size: 2em;">üì∑</div>
                                    <div class="file-upload-text">Upload Front Image</div>
                                    <input type="file" id="uploadFrontImage" accept="image/*" onchange="previewImage(this, 'uploadFrontPreview')">
                                </div>
                                <div id="uploadFrontPreview"></div>
                            </div>
                            <div class="form-group">
                                <label>Card Back Picture</label>
                                <div class="file-upload" onclick="document.getElementById('uploadBackImage').click()">
                                    <div style="font-size: 2em;">üì∑</div>
                                    <div class="file-upload-text">Upload Back Image</div>
                                    <input type="file" id="uploadBackImage" accept="image/*" onchange="previewImage(this, 'uploadBackPreview')">
                                </div>
                                <div id="uploadBackPreview"></div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Player Name</label>
                                <input type="text" id="uploadPlayerName" required>
                            </div>
                            <div class="form-group">
                                <label>Team/Club</label>
                                <select id="uploadPlayerTeam" onchange="handleClubSelect(this)">
                                    <option value="">Select Club</option>
                                </select>
                                <input type="text" id="uploadPlayerTeamCustom" placeholder="Or enter custom club name" style="margin-top: 10px; display: none;">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Card Type</label>
                                <select id="uploadCardType" onchange="handleTypeSelect(this)">
                                    <option value="">Select Type</option>
                                </select>
                                <input type="text" id="uploadCardTypeCustom" placeholder="Or enter custom type" style="margin-top: 10px; display: none;">
                            </div>
                            <div class="form-group">
                                <label>Card Company</label>
                                <select id="uploadCardCompany" required>
                                    <option value="">Select Company</option>
                                    <option value="Topps Match Attax">Topps Match Attax</option>
                                    <option value="Premier League">Premier League</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Tags (comma separated)</label>
                            <input type="text" id="uploadTags" placeholder="e.g., halloffame, rookie, limited">
                            <small style="color: #999;">Optional: Add tags like 'halloffame', 'rookie', 'limited', etc.</small>
                        </div>

                        <div class="form-group">
                            <label>Mark this card as:</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="uploadLike">
                                    <label for="uploadLike">‚ù§Ô∏è Love it</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="uploadOwn" onchange="handleOwnWantToggle('own')">
                                    <label for="uploadOwn">üí™ Own it</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="uploadWant" onchange="handleOwnWantToggle('want')">
                                    <label for="uploadWant">ü§≤ Want it</label>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn">Submit Card for Approval (Earn 1 FlipCoin!)</button>
                    </form>
                </div>
            </div>

            <!-- Your Cards Tab -->
            <div id="yourCardsTab" class="tab-content">
                <div class="stats-badge" style="margin-bottom: 20px;">
                    üì§ Cards Uploaded: <span id="uploadedCount">0</span> | üí∞ FlipCoins: <span id="yourCardsFlipcoins">0</span>
                </div>
                <div class="filter-section">
                    <h3 style="color: #ffaf00; margin-bottom: 15px;">Filter Your Cards</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn-small action-tag liked" onclick="filterYourCards('liked')">‚ù§Ô∏è Loved</button>
                        <button class="btn-small action-tag owned" onclick="filterYourCards('owned')">üí™ Owned</button>
                        <button class="btn-small action-tag wanted" onclick="filterYourCards('wanted')">ü§≤ Wanted</button>
                        <button class="btn-small btn-secondary" onclick="filterYourCards('all')">Show All</button>
                    </div>
                </div>
                <div id="yourCardsContent"></div>
            </div>

            <!-- Your Friends Tab -->
            <div id="friendsTab" class="tab-content">
                <div id="friendsContent"></div>
            </div>
        </div><!-- end dashboard inner -->
    </div><!-- end container -->

    <!-- Admin Page (separate full page) -->
    <div id="adminPage" class="hidden">
        <div class="container">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px; padding-top:20px;">
                <h2 style="color:#ff4444; font-size:1.8em;">‚öôÔ∏è Admin Panel</h2>
                <button onclick="goBackToDashboard()" style="background:#ffaf00; color:white; border:none; padding:10px 20px; border-radius:8px; font-weight:bold; cursor:pointer; font-size:1em;">‚Üê Back to FlipSid</button>
            </div>

            <div class="admin-nav">
                <div class="admin-tab active" onclick="switchAdminTab('pendingUsers')">üë§ Pending Users</div>
                <div class="admin-tab" onclick="switchAdminTab('pendingCards')">üé¥ Pending Cards</div>
                <div class="admin-tab" onclick="switchAdminTab('manageClubs')">‚öΩ Clubs</div>
                <div class="admin-tab" onclick="switchAdminTab('manageTypes')">üè∑Ô∏è Card Types</div>
                <div class="admin-tab" onclick="switchAdminTab('resetPassword')">üîë Reset Password</div>
                <div class="admin-tab" id="superAdminTab" style="display:none;" onclick="switchAdminTab('superAdmin')">üëë Super Admin</div>
            </div>

            <div id="adminTab-pendingUsers" class="admin-tab-content active">
                <div class="admin-panel" style="margin:0;">
                    <h3>üîê Pending User Approvals</h3>
                    <div id="pendingUsersList" class="pending-users"></div>
                </div>
            </div>

            <div id="adminTab-pendingCards" class="admin-tab-content">
                <div class="admin-panel" style="margin:0;">
                    <h3>üé¥ Pending Card Approvals</h3>
                    <div id="pendingCardsList" class="pending-cards-list"></div>
                </div>
            </div>

            <div id="adminTab-manageClubs" class="admin-tab-content">
                <div class="admin-panel" style="margin:0;">
                    <h3>‚öΩ Manage Approved Clubs</h3>
                    <div style="display:flex; gap:10px; margin-bottom:20px; flex-wrap:wrap;">
                        <input type="text" id="newClubName" placeholder="Club name" style="flex:1; min-width:150px; padding:10px; border:2px solid #ffd93d; border-radius:8px;">
                        <input type="text" id="newClubIcon" placeholder="Emoji icon" style="width:90px; padding:10px; border:2px solid #ffd93d; border-radius:8px;">
                        <button class="btn-approve" onclick="addClub()">Add Club</button>
                    </div>
                    <div id="clubsList"></div>
                </div>
            </div>

            <div id="adminTab-manageTypes" class="admin-tab-content">
                <div class="admin-panel" style="margin:0;">
                    <h3>üè∑Ô∏è Manage Approved Card Types</h3>
                    <div style="display:flex; gap:10px; margin-bottom:20px;">
                        <input type="text" id="newCardType" placeholder="e.g., Rookie, Legend, Icon" style="flex:1; padding:10px; border:2px solid #ffd93d; border-radius:8px;">
                        <button class="btn-approve" onclick="addCardType()">Add Type</button>
                    </div>
                    <div id="typesList"></div>
                </div>
            </div>

            <div id="adminTab-resetPassword" class="admin-tab-content">
                <div class="admin-panel" style="margin:0;">
                    <h3>üîë Reset User Password</h3>
                    <p style="color:#666; margin-bottom:20px;">Search for a user and set a new temporary password. Tell the user what it is so they can log in.</p>
                    <div style="display:flex; gap:10px; margin-bottom:20px; flex-wrap:wrap;">
                        <input type="text" id="resetSearchNickname" placeholder="Enter nickname..." style="flex:1; min-width:150px; padding:10px; border:2px solid #ffd93d; border-radius:8px;">
                        <button class="btn-small" onclick="searchUserForReset()" style="width:auto; flex:none;">Search</button>
                    </div>
                    <div id="resetUserResult"></div>
                </div>
            </div>

            <div id="adminTab-superAdmin" class="admin-tab-content">
                <div class="admin-panel" style="margin:0; border-color:#9C27B0;">
                    <h3 style="color:#9C27B0;">üëë Super Admin - Manage Admins</h3>
                    <div style="margin-bottom:20px;">
                        <h4 style="color:#666; margin-bottom:10px;">Promote User to Admin</h4>
                        <div style="display:flex; gap:10px; flex-wrap:wrap;">
                            <input type="text" id="searchUserNickname" placeholder="Search by nickname..." style="flex:1; min-width:150px; padding:10px; border:2px solid #ffd93d; border-radius:8px;">
                            <button class="btn-small" onclick="searchAndPromoteUser()" style="width:auto; flex:none;">Search & Promote</button>
                        </div>
                    </div>
                    <h4 style="color:#666; margin-bottom:10px;">Current Admins</h4>
                    <div id="adminsList"></div>
                </div>
            </div>
        </div>
    </div><!-- end adminPage -->

    <!-- Image Zoom Modal -->
    <div id="imageModal" class="modal" onclick="closeModal()">
        <span class="modal-close">&times;</span>
        <img class="modal-content" id="modalImage">
    </div>

    <!-- Edit Card Modal -->
    <div id="editModal" class="modal">
        <div class="edit-modal-content">
            <h2 style="color: #ffaf00; margin-bottom: 20px;">Edit Card</h2>
            <form id="editCardForm">
                <input type="hidden" id="editCardId">
                <div class="form-group">
                    <label>Player Name</label>
                    <input type="text" id="editPlayerName" required>
                </div>
                <div class="form-group">
                    <label>Team/Club</label>
                    <input type="text" id="editPlayerTeam" required>
                </div>
                <div class="form-group">
                    <label>Card Type</label>
                    <input type="text" id="editCardType" required>
                </div>
                <div class="form-group">
                    <label>Card Company</label>
                    <select id="editCardCompany" required>
                        <option value="Topps Match Attax">Topps Match Attax</option>
                        <option value="Premier League">Premier League</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Club Icon</label>
                    <input type="text" id="editClubIcon">
                </div>
                <div class="form-group">
                    <label>Tags (comma separated)</label>
                    <input type="text" id="editTags">
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn" onclick="saveEditedCard()">Save Changes</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- User List Modal -->
    <div id="userListModal" class="modal" onclick="closeUserListModal()">
        <div class="edit-modal-content" onclick="event.stopPropagation()">
            <h2 style="color: #ffaf00; margin-bottom: 20px;" id="userListTitle">Users</h2>
            <div id="userListContent" style="max-height: 400px; overflow-y: auto;"></div>
            <button class="btn" onclick="closeUserListModal()" style="margin-top: 20px;">Close</button>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="modal">
        <div class="edit-modal-content">
            <h2 style="color: #ffaf00; margin-bottom: 20px;">Edit Profile</h2>
            <form id="editProfileForm">
                <div class="form-group">
                    <label>Profile Picture</label>
                    <img id="currentProfilePic" class="profile-pic-upload" style="display:none;">
                    <div class="profile-pic-placeholder" id="editProfilePicPlaceholder" onclick="document.getElementById('editProfilePicInput').click()">
                        üì∑
                    </div>
                    <input type="file" id="editProfilePicInput" accept="image/*" style="display:none;" onchange="previewProfilePic(this, 'currentProfilePic', 'editProfilePicPlaceholder')">
                </div>
                <div class="form-group">
                    <label>Nickname</label>
                    <input type="text" id="editProfileNickname" required>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn" onclick="saveProfile()">Save Changes</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditProfile()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- User Profile Modal -->
    <div id="userProfileModal" class="modal" onclick="closeUserProfile()">
        <div class="edit-modal-content" onclick="event.stopPropagation()" style="max-width: 900px; width: 95%;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <img id="viewUserProfilePic" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; display: none;">
                    <div id="viewUserProfilePlaceholder" class="user-avatar" style="width: 60px; height: 60px; font-size: 1.5em;"></div>
                    <div>
                        <h2 style="color: #ffaf00; margin: 0;" id="viewUserNickname"></h2>
                        <div style="color: #999; margin-top: 5px;" id="viewUserStats"></div>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="closeUserProfile()">Close</button>
            </div>
            
            <div class="filter-section">
                <h3 style="color: #ffaf00; margin-bottom: 15px;">Filter Cards</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn-small action-tag liked" onclick="filterUserCards('liked')">‚ù§Ô∏è Loved</button>
                    <button class="btn-small action-tag owned" onclick="filterUserCards('owned')">üí™ Owned</button>
                    <button class="btn-small action-tag wanted" onclick="filterUserCards('wanted')">ü§≤ Wanted</button>
                    <button class="btn-small btn-secondary" onclick="filterUserCards('all')">Show All</button>
                </div>
            </div>

            <div id="userProfileCards" style="max-height: 60vh; overflow-y: auto;"></div>
        </div>
    </div>

    <script>
        // ============================================================
        // FIREBASE CONFIG - Replace with your own config after setup!
        // ============================================================
        const firebaseConfig = {
            apiKey: "AIzaSyAQiIbHoTyddxVdoT0UlgSp9P9mqQDYFbg",
            authDomain: "flipsid-1f16d.firebaseapp.com",
            projectId: "flipsid-1f16d",
            storageBucket: "flipsid-1f16d.firebasestorage.app",
            messagingSenderId: "735082941063",
            appId: "1:735082941063:web:567c8bbbb04b5bd22d0622",
            measurementId: "G-F2PNQMH1YF"
        };

        // Initialize Firebase
        let db = null;
        let useFirebase = false;

        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            useFirebase = firebaseConfig.apiKey !== "YOUR_API_KEY";
        } catch(e) {
            console.log('Firebase not configured, using localStorage');
        }

        // ============================================================
        // DATA LAYER - works with both Firebase and localStorage
        // ============================================================
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('flipsidUsers')) || [];
        let cards = JSON.parse(localStorage.getItem('flipsidCards')) || [];
        let cardInteractions = JSON.parse(localStorage.getItem('flipsidCardInteractions')) || {};
        let pendingCards = JSON.parse(localStorage.getItem('flipsidPendingCards')) || [];
        let follows = JSON.parse(localStorage.getItem('flipsidFollows')) || {};
        let followRequests = JSON.parse(localStorage.getItem('flipsidFollowRequests')) || {};
        let approvedClubs = JSON.parse(localStorage.getItem('flipsidApprovedClubs')) || [];
        let approvedTypes = JSON.parse(localStorage.getItem('flipsidApprovedTypes')) || [];
        let currentYourCardsFilter = 'all';

        // Save helpers - write to localStorage always, Firebase if configured
        async function saveData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
            if (useFirebase) {
                try {
                    await db.collection('flipsid').doc(key).set({ data: JSON.stringify(data) });
                } catch(e) { console.log('Firebase write error:', e); }
            }
        }

        async function loadFromFirebase() {
            if (!useFirebase) return;
            try {
                const collections = ['flipsidUsers','flipsidCards','flipsidCardInteractions',
                    'flipsidPendingCards','flipsidFollows','flipsidFollowRequests',
                    'flipsidApprovedClubs','flipsidApprovedTypes'];
                
                for (const key of collections) {
                    const doc = await db.collection('flipsid').doc(key).get();
                    if (doc.exists) {
                        const parsed = JSON.parse(doc.data().data);
                        localStorage.setItem(key, JSON.stringify(parsed));
                        // Update in-memory variables
                        if (key === 'flipsidUsers') users = parsed;
                        if (key === 'flipsidCards') cards = parsed;
                        if (key === 'flipsidCardInteractions') cardInteractions = parsed;
                        if (key === 'flipsidPendingCards') pendingCards = parsed;
                        if (key === 'flipsidFollows') follows = parsed;
                        if (key === 'flipsidFollowRequests') followRequests = parsed;
                        if (key === 'flipsidApprovedClubs') approvedClubs = parsed;
                        if (key === 'flipsidApprovedTypes') approvedTypes = parsed;
                    }
                }
                console.log('‚úÖ Loaded data from Firebase');
            } catch(e) { console.log('Firebase read error:', e); }
        }

        // Create admin user
        if (!users.find(u => u.nickname === 'flipsidadmin')) {
            users.push({
                id: 0,
                fullName: 'FlipSid Admin',
                nickname: 'flipsidadmin',
                phone: 'flipsidadmin',
                password: 'flipsidadmin123',
                isAdmin: true,
                isSuperAdmin: true,
                approved: true,
                flipcoins: 0,
                profilePic: null
            });
            saveData('flipsidUsers', users);
        }

        // Initialize approved clubs if empty
        if (approvedClubs.length === 0) {
            approvedClubs = [
                {name: "Manchester City", icon: "üíô"},
                {name: "Liverpool", icon: "‚ù§Ô∏è"},
                {name: "Arsenal", icon: "üî¥"},
                {name: "Manchester United", icon: "üî¥"},
                {name: "Chelsea", icon: "üíô"},
                {name: "Tottenham", icon: "‚ö™"},
                {name: "Newcastle", icon: "‚ö´"},
                {name: "Aston Villa", icon: "ü¶Å"},
                {name: "Real Madrid", icon: "üëë"},
                {name: "Barcelona", icon: "üíô"},
                {name: "Bayern Munich", icon: "üî¥"}
            ];
            saveData('flipsidApprovedClubs', approvedClubs);
        }

        // Initialize approved types if empty
        if (approvedTypes.length === 0) {
            approvedTypes = ["Base", "Rookie", "Legend", "Icon", "Autograph", "Limited Edition", "Goal Machine", "Playmaker", "Rising Star"];
            saveData('flipsidApprovedTypes', approvedTypes);
        }

        // Top 100 Football Players - Topps Match Attax & Premier League only
        window.onload = async function() {
            await loadFromFirebase();
            checkAuth();
        };

        function togglePasswordVisibility(inputId, eyeId) {
            const input = document.getElementById(inputId);
            const eye = document.getElementById(eyeId);
            if (input.type === 'password') {
                input.type = 'text';
                eye.textContent = 'üôà';
            } else {
                input.type = 'password';
                eye.textContent = 'üëÅÔ∏è';
            }
        }

        function checkAuth() {
            const savedUser = localStorage.getItem('flipsidCurrentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                if (currentUser.approved) {
                    showDashboard();
                } else {
                    showPendingApproval();
                }
            } else {
                showLogin();
            }
        }

        function showLogin() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('signupForm').classList.add('hidden');
            document.getElementById('pendingApproval').classList.add('hidden');
            document.getElementById('dashboard').classList.add('hidden');
        }

        function showSignup() {
            document.getElementById('signupForm').classList.remove('hidden');
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('pendingApproval').classList.add('hidden');
            document.getElementById('dashboard').classList.add('hidden');
        }

        function showPendingApproval() {
            document.getElementById('pendingApproval').classList.remove('hidden');
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('signupForm').classList.add('hidden');
            document.getElementById('dashboard').classList.add('hidden');
        }

        function showDashboard() {
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('adminPage').classList.add('hidden');
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('signupForm').classList.add('hidden');
            document.getElementById('pendingApproval').classList.add('hidden');
            document.getElementById('authButtons').classList.add('hidden');
            document.getElementById('userSection').classList.remove('hidden');
            
            document.getElementById('userName').textContent = currentUser.nickname;
            document.getElementById('headerFlipcoins').textContent = currentUser.flipcoins || 0;
            
            if (currentUser.profilePic) {
                document.getElementById('userProfilePic').src = currentUser.profilePic;
                document.getElementById('userProfilePic').style.display = 'block';
                document.getElementById('userAvatar').style.display = 'none';
            } else {
                document.getElementById('userAvatar').textContent = currentUser.nickname.charAt(0).toUpperCase();
                document.getElementById('userProfilePic').style.display = 'none';
                document.getElementById('userAvatar').style.display = 'flex';
            }
            
            if (currentUser.isAdmin) {
                document.getElementById('adminBadge').classList.remove('hidden');
                document.getElementById('adminPageBtn').classList.remove('hidden');
            } else {
                document.getElementById('adminBadge').classList.add('hidden');
                document.getElementById('adminPageBtn').classList.add('hidden');
            }
            
            populateClubsDropdown();
            populateTypesDropdown();
            loadBrowseCards();
            updateFollowRequestBadge();
        }

        function showAdminPage() {
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('adminPage').classList.remove('hidden');

            // Show super admin tab if applicable
            if (currentUser.isSuperAdmin) {
                document.getElementById('superAdminTab').style.display = 'block';
                loadAdminsList();
            }

            loadPendingUsers();
            loadPendingCards();
            loadClubsList();
            loadTypesList();

            // Reset to first tab
            switchAdminTab('pendingUsers');
        }

        function goBackToDashboard() {
            document.getElementById('adminPage').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
        }

        function switchAdminTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.admin-tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(`adminTab-${tabName}`).classList.add('active');
        }

        // Password reset
        function searchUserForReset() {
            const nickname = document.getElementById('resetSearchNickname').value.trim();
            const resultDiv = document.getElementById('resetUserResult');

            if (!nickname) {
                resultDiv.innerHTML = '<p style="color:#ff4444;">Please enter a nickname</p>';
                return;
            }

            const user = users.find(u => u.nickname.toLowerCase() === nickname.toLowerCase() && !u.isSuperAdmin);
            
            if (!user) {
                resultDiv.innerHTML = '<p style="color:#ff4444;">User not found</p>';
                return;
            }

            resultDiv.innerHTML = `
                <div class="password-reset-form">
                    <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px;">
                        ${user.profilePic ? `<img src="${user.profilePic}" style="width:40px; height:40px; border-radius:50%; object-fit:cover;">` : `<div class="user-avatar" style="width:40px; height:40px;">${user.nickname.charAt(0).toUpperCase()}</div>`}
                        <div>
                            <strong>${user.nickname}</strong>
                            <div style="color:#999; font-size:0.9em;">${user.fullName}</div>
                        </div>
                    </div>
                    <div style="display:flex; gap:10px; flex-wrap:wrap;">
                        <input type="text" id="newPasswordInput" placeholder="Enter new temporary password" 
                            style="flex:1; min-width:200px; padding:10px; border:2px solid #ffd93d; border-radius:8px;">
                        <button class="btn-approve" onclick="resetUserPassword(${user.id})">Set Password</button>
                    </div>
                    <p style="color:#999; font-size:0.85em; margin-top:10px;">‚ö†Ô∏è Tell the user their new password so they can log in and change it.</p>
                </div>
            `;
        }

        function resetUserPassword(userId) {
            const newPassword = document.getElementById('newPasswordInput').value.trim();
            if (!newPassword || newPassword.length < 4) {
                alert('Password must be at least 4 characters!');
                return;
            }

            const user = users.find(u => u.id === userId);
            if (!user) return;

            user.password = newPassword;
            saveData('flipsidUsers', users);

            document.getElementById('resetUserResult').innerHTML = `
                <div style="background:#e8f5e9; padding:20px; border-radius:10px; border:2px solid #4CAF50; text-align:center;">
                    <div style="font-size:2em; margin-bottom:10px;">‚úÖ</div>
                    <strong>${user.nickname}'s password has been reset!</strong>
                    <p style="margin-top:10px; color:#666;">New password: <strong style="color:#ff4444; font-size:1.1em;">${newPassword}</strong></p>
                    <p style="color:#999; font-size:0.85em; margin-top:10px;">Tell them this password so they can log back in.</p>
                </div>
            `;
            document.getElementById('resetSearchNickname').value = '';
        }

        function login(e) {
            e.preventDefault();
            const nickname = document.getElementById('loginNickname').value;
            const password = document.getElementById('loginPassword').value;

            const user = users.find(u => u.nickname === nickname && u.password === password);

            if (user) {
                if (!user.approved) {
                    currentUser = user;
                    localStorage.setItem('flipsidCurrentUser', JSON.stringify(user));
                    showPendingApproval();
                    return;
                }
                currentUser = user;
                localStorage.setItem('flipsidCurrentUser', JSON.stringify(user));
                showDashboard();
            } else {
                alert('Invalid credentials. Please try again.');
            }
        }

        function signup(e) {
            e.preventDefault();
            const fullName = document.getElementById('signupFullName').value;
            const nickname = document.getElementById('signupNickname').value;
            const phone = document.getElementById('signupPhone').value;
            const password = document.getElementById('signupPassword').value;
            const profilePicFile = document.getElementById('signupProfilePic').files[0];

            if (users.find(u => u.phone === phone)) {
                alert('Mobile number already registered!');
                return;
            }

            if (users.find(u => u.nickname === nickname)) {
                alert('Nickname already taken! Please choose another one.');
                return;
            }

            const newUser = {
                id: Date.now(),
                fullName,
                nickname,
                phone,
                password,
                isAdmin: false,
                isSuperAdmin: false,
                approved: false,
                flipcoins: 0,
                profilePic: null
            };

            if (profilePicFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    newUser.profilePic = e.target.result;
                    users.push(newUser);
                    saveData('flipsidUsers', users);
                    currentUser = newUser;
                    localStorage.setItem('flipsidCurrentUser', JSON.stringify(newUser));
                    showPendingApproval();
                };
                reader.readAsDataURL(profilePicFile);
            } else {
                users.push(newUser);
                saveData('flipsidUsers', users);
                currentUser = newUser;
                localStorage.setItem('flipsidCurrentUser', JSON.stringify(newUser));
                showPendingApproval();
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('flipsidCurrentUser');
            document.getElementById('userSection').classList.add('hidden');
            document.getElementById('authButtons').classList.remove('hidden');
            showLogin();
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            if (tab === 'browse') {
                document.getElementById('browseTab').classList.add('active');
                loadBrowseCards();
            } else if (tab === 'upload') {
                document.getElementById('uploadTab').classList.add('active');
            } else if (tab === 'yourCards') {
                document.getElementById('yourCardsTab').classList.add('active');
                loadYourCards();
            } else if (tab === 'friends') {
                document.getElementById('friendsTab').classList.add('active');
                loadFriends();
            }
        }

        function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);
            preview.innerHTML = '';
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const container = document.createElement('div');
                    container.className = 'preview-container';
                    
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'image-preview';
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'remove-image';
                    removeBtn.textContent = '√ó';
                    removeBtn.type = 'button';
                    removeBtn.onclick = function() {
                        input.value = '';
                        preview.innerHTML = '';
                    };
                    
                    container.appendChild(img);
                    container.appendChild(removeBtn);
                    preview.appendChild(container);
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function uploadCard(e) {
            e.preventDefault();
            
            const frontImage = document.getElementById('uploadFrontImage').files[0];
            const backImage = document.getElementById('uploadBackImage').files[0];
            
            if (!frontImage || !backImage) {
                alert('Please upload both front and back images');
                return;
            }

            const tagsInput = document.getElementById('uploadTags').value;
            const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(t => t) : [];

            const card = {
                id: Date.now(),
                playerName: document.getElementById('uploadPlayerName').value,
                team: document.getElementById('uploadPlayerTeam').value,
                clubIcon: document.getElementById('uploadClubIcon').value,
                cardType: document.getElementById('uploadCardType').value,
                company: document.getElementById('uploadCardCompany').value,
                sport: "Football",
                tags: tags,
                frontImage: null,
                backImage: null,
                uploadedBy: currentUser.id,
                uploaderNickname: currentUser.nickname,
                createdAt: new Date().toISOString(),
                approved: false,
                userInteractions: {
                    like: document.getElementById('uploadLike').checked,
                    own: document.getElementById('uploadOwn').checked,
                    want: document.getElementById("uploadWant").checked
                }
            };

            const frontReader = new FileReader();
            const backReader = new FileReader();
            
            frontReader.onload = function(e) {
                card.frontImage = e.target.result;
                
                backReader.onload = function(e) {
                    card.backImage = e.target.result;
                    
                    pendingCards.push(card);
                    saveData('flipsidPendingCards', pendingCards);
                    
                    // Reset form
                    document.querySelector('#uploadTab form').reset();
                    document.getElementById('uploadFrontPreview').innerHTML = '';
                    document.getElementById('uploadBackPreview').innerHTML = '';
                    
                    alert('Card submitted for approval! You\'ll earn 1 FlipCoin once approved. üéâ');
                    switchTab('browse');
                };
                backReader.readAsDataURL(backImage);
            };
            frontReader.readAsDataURL(frontImage);
        }

        function loadBrowseCards() {
            const container = document.getElementById('browseCardsList');
            const approvedCards = cards.filter(c => c.approved !== false);
            
            if (approvedCards.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì¶</div>
                        <h3>No Cards Available</h3>
                        <p>Cards will appear here once added</p>
                    </div>
                `;
                return;
            }

            const sortedCards = [...approvedCards].sort((a, b) => 
                getCardLikes(b.id) - getCardLikes(a.id)
            );

            container.innerHTML = sortedCards.map(card => renderCard(card, true)).join('');
        }

        function loadYourCards() {
            const container = document.getElementById('yourCardsContent');
            
            const likedCards = cards.filter(card => {
                const interactions = cardInteractions[card.id];
                return interactions && interactions.likes.includes(currentUser.id);
            });
            
            const ownedCards = cards.filter(card => {
                const interactions = cardInteractions[card.id];
                return interactions && interactions.owns.includes(currentUser.id);
            });
            
            const wantToBuyCards = cards.filter(card => {
                const interactions = cardInteractions[card.id];
                return interactions && interactions.wants.includes(currentUser.id);
            });
            
            const wantToSellCards = cards.filter(card => {
                const interactions = cardInteractions[card.id];
                return interactions && interactions.wants.includes(currentUser.id);
            });

            const uploadedCards = cards.filter(card => card.uploadedBy === currentUser.id);
            
            let html = '';
            
            html += `<div class="stats-badge">üì§ Cards Uploaded: ${uploadedCards.length} | üí∞ FlipCoins: ${currentUser.flipcoins || 0}</div>`;

            if (uploadedCards.length > 0) {
                html += '<div class="section-header">üì§ Cards I Uploaded (' + uploadedCards.length + ')</div>';
                html += '<div class="cards-grid">' + uploadedCards.map(c => renderCard(c, false)).join('') + '</div>';
            }
            
            if (likedCards.length > 0) {
                html += '<div class="section-header">‚ù§Ô∏è Liked Cards (' + likedCards.length + ')</div>';
                html += '<div class="cards-grid">' + likedCards.map(c => renderCard(c, false)).join('') + '</div>';
            }
            
            if (ownedCards.length > 0) {
                html += '<div class="section-header">‚úì Cards I Own (' + ownedCards.length + ')</div>';
                html += '<div class="cards-grid">' + ownedCards.map(c => renderCard(c, false)).join('') + '</div>';
            }
            
            if (wantToBuyCards.length > 0) {
                html += '<div class="section-header">üõí Want to Buy (' + wantToBuyCards.length + ')</div>';
                html += '<div class="cards-grid">' + wantToBuyCards.map(c => renderCard(c, false)).join('') + '</div>';
            }
            
            if (wantToSellCards.length > 0) {
                html += '<div class="section-header">ü§≤ Want (' + wantToSellCards.length + ')</div>';
                html += '<div class="cards-grid">' + wantToSellCards.map(c => renderCard(c, false)).join('') + '</div>';
            }
            
            if (html === `<div class="stats-badge">üì§ Cards Uploaded: 0 | üí∞ FlipCoins: ${currentUser.flipcoins || 0}</div>`) {
                html += `
                    <div class="empty-state">
                        <div class="empty-state-icon">üíù</div>
                        <h3>No Cards Yet</h3>
                        <p>Start uploading, liking, or marking cards!</p>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        function renderCard(card, showActions = true) {
            const interactions = cardInteractions[card.id] || {likes: [], owns: [], wants: []};
            const userLiked = interactions.likes.includes(currentUser.id);
            const userOwns = interactions.owns.includes(currentUser.id);
            const userWantsToBuy = interactions.wants.includes(currentUser.id);
            const userWantsToSell = interactions.wants.includes(currentUser.id);

            const tagsHtml = card.tags && card.tags.length > 0 ? 
                '<div class="tags">' + card.tags.map(tag => `<span class="tag ${tag.toLowerCase()}">${tag}</span>`).join('') + '</div>' : '';

            const editButtonHtml = currentUser.isAdmin ? `<button class="btn-edit-card" onclick="editApprovedCard(${card.id})">‚úèÔ∏è Edit</button>` : '';

            return `
                <div class="card-item">
                    <span class="sport-badge">${card.sport}</span>
                    <div class="card-images">
                        <div class="card-image" onclick="openModal('${card.frontImage || ''}')">
                            ${card.frontImage ? `<img src="${card.frontImage}" alt="Front">` : `${card.playerName}<br>FRONT`}
                        </div>
                        <div class="card-image" onclick="openModal('${card.backImage || ''}')">
                            ${card.backImage ? `<img src="${card.backImage}" alt="Back">` : `${card.playerName}<br>BACK`}
                        </div>
                    </div>
                    <div class="card-info">
                        <h3>${card.playerName} ${editButtonHtml}</h3>
                        <div class="card-detail">
                            <strong>Team:</strong>
                            <span>${card.team} ${card.clubIcon || ''}</span>
                        </div>
                        <div class="card-detail">
                            <strong>Type:</strong>
                            <span>${card.cardType}</span>
                        </div>
                        <div class="card-detail">
                            <strong>Company:</strong>
                            <span>${card.company}</span>
                        </div>
                        ${tagsHtml}
                        <div class="interaction-counters">
                            <div class="interaction-counter likes" onclick="showUserList(${card.id}, 'likes')">
                                ‚ù§Ô∏è ${interactions.likes.length}
                            </div>
                            <div class="interaction-counter owns" onclick="showUserList(${card.id}, 'owns')">
                                ‚úì ${interactions.owns.length}
                            </div>
                            <div class="interaction-counter wantsToBuy" onclick="showUserList(${card.id}, 'wantsToBuy')">
                                üõí ${interactions.wants.length}
                            </div>
                            <div class="interaction-counter wantsToSell" onclick="showUserList(${card.id}, 'wantsToSell')">
                                üí∞ ${interactions.wants.length}
                            </div>
                        </div>
                        ${card.uploadedBy && card.uploaderNickname ? `<div class="uploader-badge">Uploaded by: ${card.uploaderNickname}</div>` : ''}
                    </div>
                    ${showActions ? `
                        <div class="card-actions">
                            <button class="btn-small btn-icon ${userLiked ? 'btn-active' : ''}" onclick="toggleLike(${card.id})">
                                ${userLiked ? '‚ù§Ô∏è' : 'ü§ç'}
                            </button>
                            <button class="btn-small ${userOwns ? 'btn-active' : ''}" onclick="toggleOwn(${card.id})">
                                ${userOwns ? '‚úì Own' : 'Own'}
                            </button>
                            <button class="btn-small ${userWantsToBuy ? 'btn-active' : ''}" onclick="toggleWantToBuy(${card.id})">
                                ${userWantsToBuy ? '‚úì Want' : 'Want to Buy'}
                            </button>
                            <button class="btn-small ${userWantsToSell ? 'btn-active' : ''}" onclick="toggleWantToSell(${card.id})">
                                ${userWantsToSell ? '‚úì Sell' : 'Want'}
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function getCardLikes(cardId) {
            const interactions = cardInteractions[cardId];
            return interactions ? interactions.likes.length : 0;
        }

        function toggleLike(cardId) {
            if (!cardInteractions[cardId]) {
                cardInteractions[cardId] = {likes: [], owns: [], wantsToBuy: [], wantsToSell: []};
            }

            const likes = cardInteractions[cardId].likes;
            const index = likes.indexOf(currentUser.id);
            
            if (index > -1) {
                likes.splice(index, 1);
            } else {
                likes.push(currentUser.id);
            }

            saveData('flipsidCardInteractions', cardInteractions);
            loadBrowseCards();
        }

        function toggleOwn(cardId) {
            if (!cardInteractions[cardId]) {
                cardInteractions[cardId] = {likes: [], owns: [], wants: []};
            }

            const owns = cardInteractions[cardId].owns;
            const wants = cardInteractions[cardId].wants;
            const index = owns.indexOf(currentUser.id);
            
            if (index > -1) {
                // Remove from owns
                owns.splice(index, 1);
            } else {
                // Add to owns and remove from wants (mutual exclusivity)
                owns.push(currentUser.id);
                const wantIndex = wants.indexOf(currentUser.id);
                if (wantIndex > -1) {
                    wants.splice(wantIndex, 1);
                }
            }

            saveData('flipsidCardInteractions', cardInteractions);
            loadBrowseCards();
        }

        function toggleWant(cardId) {
            if (!cardInteractions[cardId]) {
                cardInteractions[cardId] = {likes: [], owns: [], wants: []};
            }

            const wants = cardInteractions[cardId].wants;
            const owns = cardInteractions[cardId].owns;
            const index = wants.indexOf(currentUser.id);
            
            if (index > -1) {
                // Remove from wants
                wants.splice(index, 1);
            } else {
                // Add to wants and remove from owns (mutual exclusivity)
                wants.push(currentUser.id);
                const ownIndex = owns.indexOf(currentUser.id);
                if (ownIndex > -1) {
                    owns.splice(ownIndex, 1);
                }
            }

            saveData('flipsidCardInteractions', cardInteractions);
            loadBrowseCards();
        }

        function handleOwnWantToggle(type) {
            if (type === 'own' && document.getElementById('uploadOwn').checked) {
                document.getElementById('uploadWant').checked = false;
            } else if (type === 'want' && document.getElementById('uploadWant').checked) {
                document.getElementById('uploadOwn').checked = false;
            }
        }

        function loadPendingUsers() {
            const pendingUsers = users.filter(u => !u.approved && !u.isAdmin);
            const container = document.getElementById('pendingUsersList');

            if (pendingUsers.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center;">No pending approvals</p>';
                return;
            }

            container.innerHTML = pendingUsers.map(user => `
                <div class="pending-user">
                    <div class="pending-user-info">
                        <strong>${user.nickname}</strong>
                        <p>Full Name: ${user.fullName}</p>
                        <p>Phone: ${user.phone}</p>
                    </div>
                    <div class="pending-user-actions">
                        <button class="btn-approve" onclick="approveUser(${user.id})">‚úì Approve</button>
                        <button class="btn-reject" onclick="rejectUser(${user.id})">‚úó Reject</button>
                    </div>
                </div>
            `).join('');
        }

        function loadPendingCards() {
            const container = document.getElementById('pendingCardsList');

            if (pendingCards.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center;">No pending card approvals</p>';
                return;
            }

            container.innerHTML = pendingCards.map(card => `
                <div class="pending-card">
                    <div>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <div class="card-image" style="width: 90px; height: 120px; font-size: 0.7em;">
                                ${card.frontImage ? `<img src="${card.frontImage}" alt="Front">` : 'FRONT'}
                            </div>
                            <div class="card-image" style="width: 90px; height: 120px; font-size: 0.7em;">
                                ${card.backImage ? `<img src="${card.backImage}" alt="Back">` : 'BACK'}
                            </div>
                        </div>
                    </div>
                    <div class="pending-card-info">
                        <strong>${card.playerName}</strong>
                        <p>Team: ${card.team} ${card.clubIcon || ''}</p>
                        <p>Type: ${card.cardType} | Company: ${card.company}</p>
                        <p>Sport: ${card.sport}</p>
                        <p>Tags: ${card.tags.join(', ') || 'None'}</p>
                        <p style="color: #ffaf00;">Uploaded by: ${card.uploaderNickname}</p>
                    </div>
                    <div class="pending-card-actions">
                        <button class="btn-edit" onclick="openEditModal(${card.id})">‚úèÔ∏è Edit</button>
                        <button class="btn-approve" onclick="approveCard(${card.id})">‚úì Approve</button>
                        <button class="btn-reject" onclick="rejectCard(${card.id})">‚úó Reject</button>
                    </div>
                </div>
            `).join('');
        }

        function approveUser(userId) {
            const user = users.find(u => u.id === userId);
            if (user) {
                user.approved = true;
                saveData('flipsidUsers', users);
                loadPendingUsers();
                alert(`${user.nickname} has been approved!`);
            }
        }

        function rejectUser(userId) {
            if (confirm('Are you sure you want to reject this user?')) {
                users = users.filter(u => u.id !== userId);
                saveData('flipsidUsers', users);
                loadPendingUsers();
            }
        }

        function openEditModal(cardId) {
            const card = pendingCards.find(c => c.id === cardId);
            if (!card) return;

            document.getElementById('editCardId').value = cardId;
            document.getElementById('editPlayerName').value = card.playerName;
            document.getElementById('editPlayerTeam').value = card.team;
            document.getElementById('editCardType').value = card.cardType;
            document.getElementById('editCardCompany').value = card.company;
            document.getElementById('editClubIcon').value = card.clubIcon || '';
            document.getElementById('editTags').value = card.tags.join(', ');

            document.getElementById('editModal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
        }

        function saveEditedCard() {
            const cardId = parseInt(document.getElementById('editCardId').value);
            const cardIndex = pendingCards.findIndex(c => c.id === cardId);
            
            if (cardIndex === -1) return;

            const card = pendingCards[cardIndex];
            card.playerName = document.getElementById('editPlayerName').value;
            card.team = document.getElementById('editPlayerTeam').value;
            card.cardType = document.getElementById('editCardType').value;
            card.company = document.getElementById('editCardCompany').value;
            card.clubIcon = document.getElementById('editClubIcon').value;
            
            const tagsInput = document.getElementById('editTags').value;
            card.tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(t => t) : [];

            approveCard(cardId);
            closeEditModal();
        }

        function approveCard(cardId) {
            const cardIndex = pendingCards.findIndex(c => c.id === cardId);
            if (cardIndex === -1) return;

            const card = pendingCards[cardIndex];
            card.approved = true;

            // Initialize interactions based on user's checkboxes
            cardInteractions[card.id] = {
                likes: card.userInteractions.like ? [card.uploadedBy] : [],
                owns: card.userInteractions.own ? [card.uploadedBy] : [],
                wants: card.userInteractions.want ? [card.uploadedBy] : []
            };

            cards.push(card);
            pendingCards.splice(cardIndex, 1);

            // Award FlipCoin to uploader
            const uploader = users.find(u => u.id === card.uploadedBy);
            if (uploader) {
                uploader.flipcoins = (uploader.flipcoins || 0) + 1;
                if (currentUser.id === uploader.id) {
                    currentUser.flipcoins = uploader.flipcoins;
                    document.getElementById('flipcoinsAmount').textContent = currentUser.flipcoins;
                }
            }

            saveData('flipsidUsers', users);
            saveData('flipsidCards', cards);
            saveData('flipsidCardInteractions', cardInteractions);
            saveData('flipsidPendingCards', pendingCards);
            localStorage.setItem('flipsidCurrentUser', JSON.stringify(currentUser));

            loadPendingCards();
            loadBrowseCards();
            alert(`Card approved! ${uploader.nickname} earned 1 FlipCoin! üéâ`);
        }

        function rejectCard(cardId) {
            if (confirm('Are you sure you want to reject this card?')) {
                pendingCards = pendingCards.filter(c => c.id !== cardId);
                saveData('flipsidPendingCards', pendingCards);
                loadPendingCards();
            }
        }

        function openModal(imageSrc) {
            if (!imageSrc) return;
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modal.classList.add('active');
            modalImg.src = imageSrc;
        }

        function closeModal() {
            document.getElementById('imageModal').classList.remove('active');
        }

        // Edit approved card (admin only)
        function editApprovedCard(cardId) {
            if (!currentUser.isAdmin) {
                alert('Only admin can edit cards');
                return;
            }

            const card = cards.find(c => c.id === cardId);
            if (!card) return;

            document.getElementById('editCardId').value = cardId;
            document.getElementById('editPlayerName').value = card.playerName;
            document.getElementById('editPlayerTeam').value = card.team;
            document.getElementById('editCardType').value = card.cardType;
            document.getElementById('editCardCompany').value = card.company;
            document.getElementById('editClubIcon').value = card.clubIcon || '';
            document.getElementById('editTags').value = card.tags.join(', ');

            document.getElementById('editModal').classList.add('active');
        }

        function saveEditedCard() {
            const cardId = parseInt(document.getElementById('editCardId').value);
            
            // Check if editing pending card or approved card
            let card = pendingCards.find(c => c.id === cardId);
            let isPending = true;
            
            if (!card) {
                card = cards.find(c => c.id === cardId);
                isPending = false;
            }
            
            if (!card) return;

            card.playerName = document.getElementById('editPlayerName').value;
            card.team = document.getElementById('editPlayerTeam').value;
            card.cardType = document.getElementById('editCardType').value;
            card.company = document.getElementById('editCardCompany').value;
            card.clubIcon = document.getElementById('editClubIcon').value;
            
            const tagsInput = document.getElementById('editTags').value;
            card.tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(t => t) : [];

            if (isPending) {
                saveData('flipsidPendingCards', pendingCards);
                approveCard(cardId);
            } else {
                saveData('flipsidCards', cards);
                loadBrowseCards();
                alert('Card updated successfully!');
            }

            closeEditModal();
        }

        // Show user list modal
        function showUserList(cardId, interactionType) {
            const interactions = cardInteractions[cardId];
            if (!interactions) return;

            let userIds = [];
            let title = '';

            if (interactionType === 'likes') {
                userIds = interactions.likes;
                title = '‚ù§Ô∏è Loved by';
            } else if (interactionType === 'owns') {
                userIds = interactions.owns;
                title = 'üí™ Owned by';
            } else if (interactionType === 'wants') {
                userIds = interactions.wants;
                title = 'ü§≤ Wanted by';
            }

            if (userIds.length === 0) {
                alert('No users yet!');
                return;
            }

            document.getElementById('userListTitle').textContent = title;
            
            const html = userIds.map(userId => {
                const user = users.find(u => u.id === userId);
                if (!user) return '';
                
                const isFollowing = follows[currentUser.id] && follows[currentUser.id].includes(userId);
                const isSelf = userId === currentUser.id;
                
                return `
                    <div class="user-list-item">
                        <div>
                            <strong>${user.nickname}</strong>
                            ${user.flipcoins ? `<div style="color: #999; font-size: 0.9em;">üí∞ ${user.flipcoins} FlipCoins</div>` : ''}
                        </div>
                        ${!isSelf ? `
                            <button class="follow-btn ${isFollowing ? 'following' : ''}" onclick="toggleFollow(${userId})">
                                ${isFollowing ? '‚úì Following' : '+ Follow'}
                            </button>
                        ` : ''}
                    </div>
                `;
            }).join('');

            document.getElementById('userListContent').innerHTML = html;
            document.getElementById('userListModal').classList.add('active');
        }

        function closeUserListModal() {
            document.getElementById('userListModal').classList.remove('active');
        }

        // Follow system
        function toggleFollow(userId) {
            if (!follows[currentUser.id]) {
                follows[currentUser.id] = [];
            }

            const index = follows[currentUser.id].indexOf(userId);
            
            if (index > -1) {
                follows[currentUser.id].splice(index, 1);
            } else {
                follows[currentUser.id].push(userId);
            }

            saveData('flipsidFollows', follows);
            
            // Reload the modal to update button state
            const modal = document.getElementById('userListModal');
            if (modal.classList.contains('active')) {
                // Re-render the current modal content
                document.querySelectorAll('.follow-btn').forEach(btn => {
                    const btnUserId = parseInt(btn.getAttribute('onclick').match(/\d+/)[0]);
                    if (btnUserId === userId) {
                        const isNowFollowing = follows[currentUser.id].includes(userId);
                        btn.className = isNowFollowing ? 'follow-btn following' : 'follow-btn';
                        btn.textContent = isNowFollowing ? '‚úì Following' : '+ Follow';
                    }
                });
            }
        }

        // Load friends tab with combined list
        function loadFriends() {
            const container = document.getElementById('friendsContent');
            
            const following = follows[currentUser.id] || [];
            const followers = Object.keys(follows).filter(userId => 
                follows[userId].includes(currentUser.id) && parseInt(userId) !== currentUser.id
            ).map(id => parseInt(id));

            // Get pending follow requests TO me
            const pendingRequestsToMe = followRequests[currentUser.id] || [];

            let html = '';

            // Show pending follow requests first
            if (pendingRequestsToMe.length > 0) {
                html += '<div class="section-header" style="background: linear-gradient(135deg, #FF9800, #F57C00);">üîî Follow Requests (' + pendingRequestsToMe.length + ')</div>';
                html += '<div style="display: grid; gap: 15px; margin-bottom: 30px;">';
                pendingRequestsToMe.forEach(requesterId => {
                    const requester = users.find(u => u.id === requesterId);
                    if (requester) {
                        html += `
                            <div class="user-list-item" style="border-color: #FF9800;">
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        ${requester.profilePic ? `<img src="${requester.profilePic}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">` : `<div class="user-avatar" style="width: 40px; height: 40px;">${requester.nickname.charAt(0).toUpperCase()}</div>`}
                                        <strong>${requester.nickname}</strong>
                                    </div>
                                    <div style="color: #FF9800; font-size: 0.9em; margin-top: 5px;">Wants you to follow them back</div>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn-approve" onclick="acceptFollowRequest(${requesterId})">Accept</button>
                                    <button class="btn-reject" onclick="rejectFollowRequest(${requesterId})">Decline</button>
                                </div>
                            </div>
                        `;
                    }
                });
                html += '</div>';
            }

            // Get all unique users (following + followers)
            const allFriendIds = [...new Set([...following, ...followers])];
            const allFriends = allFriendIds.map(id => users.find(u => u.id === id)).filter(u => u);

            html += '<div class="section-header">üë• Friends & Followers</div>';
            
            if (allFriends.length === 0) {
                html += `
                    <div class="empty-state">
                        <div class="empty-state-icon">üë•</div>
                        <h3>No Friends Yet</h3>
                        <p>Start following other users to build your network!</p>
                    </div>
                `;
            } else {
                html += '<div style="display: grid; gap: 15px; margin-bottom: 30px;">';
                allFriends.forEach(user => {
                    const isFollowing = following.includes(user.id);
                    const isFollower = followers.includes(user.id);
                    const hasSentRequest = followRequests[user.id] && followRequests[user.id].includes(currentUser.id);
                    
                    html += `
                        <div class="user-list-item">
                            <div style="flex: 1; cursor: pointer;" onclick="viewUserProfile(${user.id})">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    ${user.profilePic ? `<img src="${user.profilePic}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">` : `<div class="user-avatar" style="width: 40px; height: 40px;">${user.nickname.charAt(0).toUpperCase()}</div>`}
                                    <div>
                                        <strong>${user.nickname}</strong>
                                        <div style="display: flex; gap: 5px; margin-top: 3px;">
                                            ${isFollowing ? '<span style="background: #4CAF50; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75em;">Following</span>' : ''}
                                            ${isFollower ? '<span style="background: #2196F3; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75em;">Follows You</span>' : ''}
                                            ${hasSentRequest ? '<span style="background: #FF9800; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75em;">Request Sent</span>' : ''}
                                        </div>
                                    </div>
                                </div>
                                ${user.flipcoins ? `<div style="color: #999; font-size: 0.9em; margin-top: 5px;">üí∞ ${user.flipcoins} FlipCoins</div>` : ''}
                            </div>
                            <div style="display: flex; gap: 10px; flex-direction: column;">
                                ${isFollowing ? 
                                    `<button class="follow-btn following" onclick="toggleFollow(${user.id}); loadFriends();">‚úì Following</button>` : 
                                    hasSentRequest ? 
                                    `<button class="btn-small btn-secondary" disabled style="opacity: 0.6;">Request Sent</button>` :
                                    `<button class="follow-btn" onclick="toggleFollow(${user.id}); loadFriends();">+ Follow</button>`
                                }
                                ${isFollower && !isFollowing && !hasSentRequest ? 
                                    `<button class="btn-small" onclick="sendFollowRequest(${user.id}); loadFriends();" style="background: #FF9800;">üì® Ask to Follow</button>` : 
                                    ''
                                }
                                <button class="btn-small btn-secondary" onclick="viewUserProfile(${user.id})">View Cards</button>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }

            // Discover section
            const allOtherUsers = users.filter(u => 
                u.id !== currentUser.id && 
                u.approved && 
                !u.isAdmin &&
                !allFriendIds.includes(u.id)
            );

            if (allOtherUsers.length > 0) {
                html += '<div class="section-header">üîç Discover Users</div>';
                html += '<div style="display: grid; gap: 15px;">';
                allOtherUsers.forEach(user => {
                    const hasSentRequest = followRequests[user.id] && followRequests[user.id].includes(currentUser.id);
                    
                    html += `
                        <div class="user-list-item">
                            <div style="flex: 1; cursor: pointer;" onclick="viewUserProfile(${user.id})">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    ${user.profilePic ? `<img src="${user.profilePic}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">` : `<div class="user-avatar" style="width: 40px; height: 40px;">${user.nickname.charAt(0).toUpperCase()}</div>`}
                                    <div>
                                        <strong>${user.nickname}</strong>
                                        ${hasSentRequest ? '<div style="color: #FF9800; font-size: 0.75em; margin-top: 3px;">Request Sent</div>' : ''}
                                    </div>
                                </div>
                                ${user.flipcoins ? `<div style="color: #999; font-size: 0.9em; margin-top: 5px;">üí∞ ${user.flipcoins} FlipCoins</div>` : ''}
                            </div>
                            <div style="display: flex; gap: 10px; flex-direction: column;">
                                ${hasSentRequest ? 
                                    `<button class="btn-small btn-secondary" disabled style="opacity: 0.6;">Request Sent</button>` :
                                    `<button class="follow-btn" onclick="toggleFollow(${user.id}); loadFriends();">+ Follow</button>`
                                }
                                ${!hasSentRequest ? 
                                    `<button class="btn-small" onclick="sendFollowRequest(${user.id}); loadFriends();" style="background: #FF9800;">üì® Ask to Follow</button>` : 
                                    ''
                                }
                                <button class="btn-small btn-secondary" onclick="viewUserProfile(${user.id})">View Cards</button>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }

            container.innerHTML = html;
            updateFollowRequestBadge();
        }

        // Profile picture preview
        function previewProfilePic(input, imgId, placeholderId) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById(imgId);
                    img.src = e.target.result;
                    img.style.display = 'block';
                    if (placeholderId) {
                        document.getElementById(placeholderId).style.display = 'none';
                    }
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Edit Profile
        function showEditProfile() {
            document.getElementById('editProfileNickname').value = currentUser.nickname;
            if (currentUser.profilePic) {
                document.getElementById('currentProfilePic').src = currentUser.profilePic;
                document.getElementById('currentProfilePic').style.display = 'block';
                document.getElementById('editProfilePicPlaceholder').style.display = 'none';
            }
            document.getElementById('editProfileModal').classList.add('active');
        }

        function closeEditProfile() {
            document.getElementById('editProfileModal').classList.remove('active');
        }

        function saveProfile() {
            const newNickname = document.getElementById('editProfileNickname').value;
            const profilePicFile = document.getElementById('editProfilePicInput').files[0];

            if (newNickname !== currentUser.nickname && users.find(u => u.nickname === newNickname && u.id !== currentUser.id)) {
                alert('Nickname already taken!');
                return;
            }

            currentUser.nickname = newNickname;

            if (profilePicFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentUser.profilePic = e.target.result;
                    updateUserAndRefresh();
                };
                reader.readAsDataURL(profilePicFile);
            } else {
                updateUserAndRefresh();
            }
        }

        function updateUserAndRefresh() {
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            users[userIndex] = currentUser;
            saveData('flipsidUsers', users);
            localStorage.setItem('flipsidCurrentUser', JSON.stringify(currentUser));
            closeEditProfile();
            showDashboard();
        }

        // Filter functions for browse cards
        function applyFilters() {
            const searchText = document.getElementById('searchText').value.toLowerCase();
            const filterTeam = document.getElementById('filterTeam').value;
            const filterType = document.getElementById('filterType').value;
            const filterCompany = document.getElementById('filterCompany').value;

            const filtered = cards.filter(card => {
                if (!card.approved) return false;
                if (searchText && !card.playerName.toLowerCase().includes(searchText)) return false;
                if (filterTeam && card.team !== filterTeam) return false;
                if (filterType && card.cardType !== filterType) return false;
                if (filterCompany && card.company !== filterCompany) return false;
                return true;
            });

            const container = document.getElementById('browseCardsList');
            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üîç</div><h3>No cards found</h3><p>Try different filters</p></div>';
                return;
            }

            const sorted = [...filtered].sort((a, b) => getCardLikes(b.id) - getCardLikes(a.id));
            container.innerHTML = sorted.map(card => renderCard(card, true)).join('');
            
            // Update filter dropdowns with available options
            updateFilterOptions();
        }

        function clearFilters() {
            document.getElementById('searchText').value = '';
            document.getElementById('filterTeam').value = '';
            document.getElementById('filterType').value = '';
            document.getElementById('filterCompany').value = '';
            loadBrowseCards();
        }

        function updateFilterOptions() {
            const teams = [...new Set(cards.filter(c => c.approved).map(c => c.team))].sort();
            const types = [...new Set(cards.filter(c => c.approved).map(c => c.cardType))].sort();
            
            const teamSelect = document.getElementById('filterTeam');
            const currentTeam = teamSelect.value;
            teamSelect.innerHTML = '<option value="">All Teams</option>' + teams.map(t => `<option value="${t}">${t}</option>`).join('');
            if (teams.includes(currentTeam)) teamSelect.value = currentTeam;

            const typeSelect = document.getElementById('filterType');
            const currentType = typeSelect.value;
            typeSelect.innerHTML = '<option value="">All Types</option>' + types.map(t => `<option value="${t}">${t}</option>`).join('');
            if (types.includes(currentType)) typeSelect.value = currentType;
        }

        // Your Cards filter
        function filterYourCards(filter) {
            currentYourCardsFilter = filter;
            loadYourCards();
        }

        // Update loadYourCards to show action tags
        function loadYourCards() {
            const container = document.getElementById('yourCardsContent');
            
            let userCards = [];
            if (currentYourCardsFilter === 'all' || currentYourCardsFilter === 'liked') {
                userCards = userCards.concat(cards.filter(card => {
                    const interactions = cardInteractions[card.id];
                    return interactions && interactions.likes.includes(currentUser.id);
                }));
            }
            if (currentYourCardsFilter === 'all' || currentYourCardsFilter === 'owned') {
                userCards = userCards.concat(cards.filter(card => {
                    const interactions = cardInteractions[card.id];
                    return interactions && interactions.owns.includes(currentUser.id);
                }));
            }
            if (currentYourCardsFilter === 'all' || currentYourCardsFilter === 'wanted') {
                userCards = userCards.concat(cards.filter(card => {
                    const interactions = cardInteractions[card.id];
                    return interactions && interactions.wants.includes(currentUser.id);
                }));
            }

            // Remove duplicates
            userCards = [...new Set(userCards)];

            const uploadedCards = cards.filter(card => card.uploadedBy === currentUser.id);

            document.getElementById('uploadedCount').textContent = uploadedCards.length;
            document.getElementById('yourCardsFlipcoins').textContent = currentUser.flipcoins || 0;

            if (userCards.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üíù</div><h3>No cards yet</h3><p>Start interacting with cards!</p></div>';
                return;
            }

            container.innerHTML = '<div class="cards-grid">' + userCards.map(card => renderCardWithTags(card)).join('') + '</div>';
        }

        function renderCardWithTags(card) {
            const interactions = cardInteractions[card.id] || {likes: [], owns: [], wants: []};
            const userLiked = interactions.likes.includes(currentUser.id);
            const userOwns = interactions.owns.includes(currentUser.id);
            const userWants = interactions.wants.includes(currentUser.id);

            let actionTagsHtml = '<div class="action-tags">';
            if (userLiked) actionTagsHtml += '<span class="action-tag liked">‚ù§Ô∏è Loved</span>';
            if (userOwns) actionTagsHtml += '<span class="action-tag owned">üí™ Owned</span>';
            if (userWants) actionTagsHtml += '<span class="action-tag wanted">ü§≤ Wanted</span>';
            actionTagsHtml += '</div>';

            return `
                <div class="card-item" style="position: relative;">
                    <div class="card-id-badge">#${card.id}</div>
                    <div class="sport-icon">‚öΩ</div>
                    <div class="card-images">
                        <div class="card-image" onclick="openModal('${card.frontImage || ''}')">
                            ${card.frontImage ? `<img src="${card.frontImage}" alt="Front">` : `${card.playerName}<br>FRONT`}
                        </div>
                        <div class="card-image" onclick="openModal('${card.backImage || ''}')">
                            ${card.backImage ? `<img src="${card.backImage}" alt="Back">` : `${card.playerName}<br>BACK`}
                        </div>
                    </div>
                    <div class="card-info">
                        <h3>${card.playerName}</h3>
                        <div class="card-detail"><strong>Team:</strong><span>${card.team} ${card.clubIcon || ''}</span></div>
                        <div class="card-detail"><strong>Type:</strong><span>${card.cardType}</span></div>
                        <div class="card-detail"><strong>Company:</strong><span>${card.company}</span></div>
                        ${card.tags && card.tags.length > 0 ? '<div class="tags">' + card.tags.map(tag => `<span class="tag ${tag.toLowerCase()}">${tag}</span>`).join('') + '</div>' : ''}
                        ${actionTagsHtml}
                    </div>
                </div>
            `;
        }

        // Clubs management
        function populateClubsDropdown() {
            const select = document.getElementById('uploadPlayerTeam');
            select.innerHTML = '<option value="">Select Club</option>' + 
                approvedClubs.map(club => `<option value="${club.name}">${club.name} ${club.icon}</option>`).join('') +
                '<option value="custom">+ Add Custom Club</option>';
        }

        function handleClubSelect(select) {
            const customInput = document.getElementById('uploadPlayerTeamCustom');
            if (select.value === 'custom') {
                customInput.style.display = 'block';
                customInput.required = true;
            } else {
                customInput.style.display = 'none';
                customInput.required = false;
            }
        }

        function loadClubsList() {
            const container = document.getElementById('clubsList');
            container.innerHTML = approvedClubs.map((club, index) => `
                <div class="user-list-item">
                    <div><strong>${club.name}</strong> ${club.icon}</div>
                    <button class="btn-reject" onclick="removeClub(${index})">Remove</button>
                </div>
            `).join('');
        }

        function addClub() {
            const name = document.getElementById('newClubName').value.trim();
            const icon = document.getElementById('newClubIcon').value.trim();
            if (!name) {
                alert('Please enter club name');
                return;
            }
            approvedClubs.push({name, icon: icon || '‚öΩ'});
            saveData('flipsidApprovedClubs', approvedClubs);
            document.getElementById('newClubName').value = '';
            document.getElementById('newClubIcon').value = '';
            loadClubsList();
            populateClubsDropdown();
        }

        function removeClub(index) {
            if (confirm('Remove this club?')) {
                approvedClubs.splice(index, 1);
                saveData('flipsidApprovedClubs', approvedClubs);
                loadClubsList();
                populateClubsDropdown();
            }
        }

        // Card types management
        function populateTypesDropdown() {
            const select = document.getElementById('uploadCardType');
            select.innerHTML = '<option value="">Select Type</option>' + 
                approvedTypes.map(type => `<option value="${type}">${type}</option>`).join('') +
                '<option value="custom">+ Add Custom Type</option>';
        }

        function handleTypeSelect(select) {
            const customInput = document.getElementById('uploadCardTypeCustom');
            if (select.value === 'custom') {
                customInput.style.display = 'block';
                customInput.required = true;
            } else {
                customInput.style.display = 'none';
                customInput.required = false;
            }
        }

        function loadTypesList() {
            const container = document.getElementById('typesList');
            container.innerHTML = approvedTypes.map((type, index) => `
                <div class="user-list-item">
                    <div><strong>${type}</strong></div>
                    <button class="btn-reject" onclick="removeType(${index})">Remove</button>
                </div>
            `).join('');
        }

        function addCardType() {
            const type = document.getElementById('newCardType').value.trim();
            if (!type) {
                alert('Please enter card type');
                return;
            }
            approvedTypes.push(type);
            saveData('flipsidApprovedTypes', approvedTypes);
            document.getElementById('newCardType').value = '';
            loadTypesList();
            populateTypesDropdown();
        }

        function removeType(index) {
            if (confirm('Remove this type?')) {
                approvedTypes.splice(index, 1);
                saveData('flipsidApprovedTypes', approvedTypes);
                loadTypesList();
                populateTypesDropdown();
            }
        }

        // Super admin functions
        function loadAdminsList() {
            const admins = users.filter(u => u.isAdmin);
            const container = document.getElementById('adminsList');
            container.innerHTML = admins.map(admin => `
                <div class="user-list-item">
                    <div>
                        <strong>${admin.nickname}</strong>
                        ${admin.isSuperAdmin ? '<span style="color: #9C27B0;"> (Super Admin)</span>' : ''}
                        <div style="color: #999; font-size: 0.9em;">${admin.fullName}</div>
                    </div>
                    ${!admin.isSuperAdmin ? `<button class="btn-reject" onclick="removeAdmin(${admin.id})">Remove Admin</button>` : ''}
                </div>
            `).join('');
        }

        function searchAndPromoteUser() {
            const nickname = document.getElementById('searchUserNickname').value.trim();
            if (!nickname) {
                alert('Enter a nickname');
                return;
            }
            const user = users.find(u => u.nickname.toLowerCase() === nickname.toLowerCase() && !u.isAdmin);
            if (!user) {
                alert('User not found or already an admin');
                return;
            }
            if (confirm(`Make ${user.nickname} an admin?`)) {
                user.isAdmin = true;
                saveData('flipsidUsers', users);
                document.getElementById('searchUserNickname').value = '';
                loadAdminsList();
                alert(`${user.nickname} is now an admin!`);
            }
        }

        function removeAdmin(userId) {
            if (confirm('Remove admin privileges?')) {
                const user = users.find(u => u.id === userId);
                user.isAdmin = false;
                saveData('flipsidUsers', users);
                loadAdminsList();
            }
        }

        // Render card with new UI - heart icon + count, Own/Want on one row
        function renderCard(card, showActions = true) {
            const interactions = cardInteractions[card.id] || {likes: [], owns: [], wants: []};
            const userLiked = interactions.likes.includes(currentUser.id);
            const userOwns = interactions.owns.includes(currentUser.id);
            const userWants = interactions.wants.includes(currentUser.id);

            const tagsHtml = card.tags && card.tags.length > 0 ? 
                '<div class="tags">' + card.tags.map(tag => `<span class="tag ${tag.toLowerCase()}">${tag}</span>`).join('') + '</div>' : '';

            const editButtonHtml = currentUser.isAdmin ? `<button class="btn-edit-card" onclick="editApprovedCard(${card.id})">‚úèÔ∏è</button>` : '';
            const uploaderHtml = currentUser.isAdmin && card.uploaderNickname ? 
                `<div class="uploader-badge">‚¨ÜÔ∏è ${card.uploaderNickname}</div>` : '';

            return `
                <div class="card-item" style="position: relative;">
                    <div class="card-id-badge">#${card.id}</div>
                    <div class="card-images">
                        <div class="card-image" onclick="openModal('${card.frontImage || ''}')">
                            ${card.frontImage ? `<img src="${card.frontImage}" alt="Front">` : `${card.playerName}<br>FRONT`}
                        </div>
                        <div class="card-image" onclick="openModal('${card.backImage || ''}')">
                            ${card.backImage ? `<img src="${card.backImage}" alt="Back">` : `${card.playerName}<br>BACK`}
                        </div>
                    </div>
                    <div class="card-info">
                        <div class="card-title-row">
                            <h3>${card.playerName}</h3>
                            <div class="card-title-actions">
                                <span class="heart-icon ${userLiked ? 'liked' : ''}" onclick="toggleLike(${card.id})" title="Love it">
                                    ${userLiked ? '‚ù§Ô∏è' : 'ü§ç'} <span class="heart-count" onclick="event.stopPropagation(); showUserList(${card.id}, 'likes')">${interactions.likes.length}</span>
                                </span>
                                ${editButtonHtml}
                            </div>
                        </div>
                        <div class="card-detail"><strong>Team:</strong><span>${card.team} ${card.clubIcon || ''}</span></div>
                        <div class="card-detail"><strong>Type:</strong><span>${card.cardType}</span></div>
                        <div class="card-detail"><strong>Company:</strong><span>${card.company}</span></div>
                        ${tagsHtml}
                        <div class="interaction-counters">
                            <div class="interaction-counter owns" onclick="showUserList(${card.id}, 'owns')">üí™ ${interactions.owns.length} owners</div>
                            <div class="interaction-counter wants" onclick="showUserList(${card.id}, 'wants')">ü§≤ ${interactions.wants.length} wanting</div>
                        </div>
                        ${uploaderHtml}
                    </div>
                    ${showActions ? `
                        <div class="card-actions">
                            <button class="btn-small ${userOwns ? 'btn-active' : ''}" onclick="toggleOwn(${card.id})" ${userWants ? 'disabled style="opacity:0.4;"' : ''}>
                                ${userOwns ? 'üí™ Own ‚úì' : 'üí™ Own'}
                            </button>
                            <button class="btn-small ${userWants ? 'btn-active' : ''}" onclick="toggleWant(${card.id})" ${userOwns ? 'disabled style="opacity:0.4;"' : ''}>
                                ${userWants ? 'ü§≤ Want ‚úì' : 'ü§≤ Want'}
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Update loadBrowseCards to use filters
        function loadBrowseCards() {
            updateFilterOptions();
            applyFilters();
        }

        // Update uploadCard to handle custom clubs/types
        function uploadCard(e) {
            e.preventDefault();
            
            const frontImage = document.getElementById('uploadFrontImage').files[0];
            const backImage = document.getElementById('uploadBackImage').files[0];
            
            if (!frontImage || !backImage) {
                alert('Please upload both front and back images');
                return;
            }

            let team = document.getElementById('uploadPlayerTeam').value;
            if (team === 'custom') {
                team = document.getElementById('uploadPlayerTeamCustom').value.trim();
                if (!team) {
                    alert('Please enter custom club name');
                    return;
                }
            }

            let cardType = document.getElementById('uploadCardType').value;
            if (cardType === 'custom') {
                cardType = document.getElementById('uploadCardTypeCustom').value.trim();
                if (!cardType) {
                    alert('Please enter custom card type');
                    return;
                }
            }

            const tagsInput = document.getElementById('uploadTags').value;
            const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(t => t) : [];

            const card = {
                id: Date.now(),
                playerName: document.getElementById('uploadPlayerName').value,
                team: team,
                clubIcon: approvedClubs.find(c => c.name === team)?.icon || '',
                cardType: cardType,
                company: document.getElementById('uploadCardCompany').value,
                sport: "Football",
                tags: tags,
                frontImage: null,
                backImage: null,
                uploadedBy: currentUser.id,
                uploaderNickname: currentUser.nickname,
                createdAt: new Date().toISOString(),
                approved: false,
                userInteractions: {
                    like: document.getElementById('uploadLike').checked,
                    own: document.getElementById('uploadOwn').checked,
                    want: document.getElementById("uploadWant").checked,
                    
                }
            };

            const frontReader = new FileReader();
            const backReader = new FileReader();
            
            frontReader.onload = function(e) {
                card.frontImage = e.target.result;
                
                backReader.onload = function(e) {
                    card.backImage = e.target.result;
                    
                    pendingCards.push(card);
                    saveData('flipsidPendingCards', pendingCards);
                    
                    document.querySelector('#uploadTab form').reset();
                    document.getElementById('uploadFrontPreview').innerHTML = '';
                    document.getElementById('uploadBackPreview').innerHTML = '';
                    document.getElementById('uploadPlayerTeamCustom').style.display = 'none';
                    document.getElementById('uploadCardTypeCustom').style.display = 'none';
                    
                    alert('Card submitted for approval! You\'ll earn 1 FlipCoin once approved. üéâ');
                    switchTab('browse');
                };
                backReader.readAsDataURL(backImage);
            };
            frontReader.readAsDataURL(frontImage);
        }

        // Update approveCard to add new clubs/types to approved lists
        function approveCard(cardId) {
            const cardIndex = pendingCards.findIndex(c => c.id === cardId);
            if (cardIndex === -1) return;

            const card = pendingCards[cardIndex];
            card.approved = true;

            // Add new club to approved list if not present
            if (!approvedClubs.find(c => c.name === card.team)) {
                approvedClubs.push({name: card.team, icon: card.clubIcon || '‚öΩ'});
                saveData('flipsidApprovedClubs', approvedClubs);
            }

            // Add new type to approved list if not present
            if (!approvedTypes.includes(card.cardType)) {
                approvedTypes.push(card.cardType);
                saveData('flipsidApprovedTypes', approvedTypes);
            }

            cardInteractions[card.id] = {
                likes: card.userInteractions.like ? [card.uploadedBy] : [],
                owns: card.userInteractions.own ? [card.uploadedBy] : [],
                wants: card.userInteractions.want ? [card.uploadedBy] : []
            };

            cards.push(card);
            pendingCards.splice(cardIndex, 1);

            const uploader = users.find(u => u.id === card.uploadedBy);
            if (uploader) {
                uploader.flipcoins = (uploader.flipcoins || 0) + 1;
                if (currentUser.id === uploader.id) {
                    currentUser.flipcoins = uploader.flipcoins;
                    document.getElementById('headerFlipcoins').textContent = currentUser.flipcoins;
                }
            }

            saveData('flipsidUsers', users);
            saveData('flipsidCards', cards);
            saveData('flipsidCardInteractions', cardInteractions);
            saveData('flipsidPendingCards', pendingCards);
            localStorage.setItem('flipsidCurrentUser', JSON.stringify(currentUser));

            loadPendingCards();
            loadBrowseCards();
            loadClubsList();
            loadTypesList();
            populateClubsDropdown();
            populateTypesDropdown();
            alert(`Card approved! ${uploader.nickname} earned 1 FlipCoin! üéâ`);
        }

        let currentViewingUserId = null;
        let currentUserCardFilter = 'all';

        // View user profile
        function viewUserProfile(userId) {
            currentViewingUserId = userId;
            currentUserCardFilter = 'all';
            
            const user = users.find(u => u.id === userId);
            if (!user) return;

            document.getElementById('viewUserNickname').textContent = user.nickname;
            document.getElementById('viewUserStats').textContent = `üí∞ ${user.flipcoins || 0} FlipCoins`;
            
            if (user.profilePic) {
                document.getElementById('viewUserProfilePic').src = user.profilePic;
                document.getElementById('viewUserProfilePic').style.display = 'block';
                document.getElementById('viewUserProfilePlaceholder').style.display = 'none';
            } else {
                document.getElementById('viewUserProfilePlaceholder').textContent = user.nickname.charAt(0).toUpperCase();
                document.getElementById('viewUserProfilePic').style.display = 'none';
                document.getElementById('viewUserProfilePlaceholder').style.display = 'flex';
            }

            loadUserCards();
            document.getElementById('userProfileModal').classList.add('active');
        }

        function closeUserProfile() {
            document.getElementById('userProfileModal').classList.remove('active');
            currentViewingUserId = null;
        }

        function filterUserCards(filter) {
            currentUserCardFilter = filter;
            loadUserCards();
        }

        function loadUserCards() {
            if (!currentViewingUserId) return;

            const container = document.getElementById('userProfileCards');
            
            let userCards = [];
            if (currentUserCardFilter === 'all' || currentUserCardFilter === 'liked') {
                userCards = userCards.concat(cards.filter(card => {
                    const interactions = cardInteractions[card.id];
                    return interactions && interactions.likes.includes(currentViewingUserId);
                }));
            }
            if (currentUserCardFilter === 'all' || currentUserCardFilter === 'owned') {
                userCards = userCards.concat(cards.filter(card => {
                    const interactions = cardInteractions[card.id];
                    return interactions && interactions.owns.includes(currentViewingUserId);
                }));
            }
            if (currentUserCardFilter === 'all' || currentUserCardFilter === 'wanted') {
                userCards = userCards.concat(cards.filter(card => {
                    const interactions = cardInteractions[card.id];
                    return interactions && interactions.wants.includes(currentViewingUserId);
                }));
            }

            // Remove duplicates
            userCards = [...new Set(userCards)];

            if (userCards.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì¶</div><h3>No cards yet</h3><p>This user hasn\'t interacted with any cards yet</p></div>';
                return;
            }

            container.innerHTML = '<div class="cards-grid">' + userCards.map(card => renderUserCard(card, currentViewingUserId)).join('') + '</div>';
        }

        // Follow request functions
        function sendFollowRequest(userId) {
            if (!followRequests[userId]) {
                followRequests[userId] = [];
            }
            
            if (!followRequests[userId].includes(currentUser.id)) {
                followRequests[userId].push(currentUser.id);
                saveData('flipsidFollowRequests', followRequests);
                alert('Follow request sent! üì®');
            }
        }

        function acceptFollowRequest(requesterId) {
            // Add to my following list
            if (!follows[currentUser.id]) {
                follows[currentUser.id] = [];
            }
            
            if (!follows[currentUser.id].includes(requesterId)) {
                follows[currentUser.id].push(requesterId);
                saveData('flipsidFollows', follows);
            }

            // Remove from pending requests
            if (followRequests[currentUser.id]) {
                followRequests[currentUser.id] = followRequests[currentUser.id].filter(id => id !== requesterId);
                saveData('flipsidFollowRequests', followRequests);
            }

            loadFriends();
            alert('You are now following this user! ‚úÖ');
        }

        function rejectFollowRequest(requesterId) {
            if (followRequests[currentUser.id]) {
                followRequests[currentUser.id] = followRequests[currentUser.id].filter(id => id !== requesterId);
                saveData('flipsidFollowRequests', followRequests);
            }
            loadFriends();
        }

        function updateFollowRequestBadge() {
            const pendingRequestsToMe = followRequests[currentUser.id] || [];
            const badge = document.getElementById('friendRequestBadge');
            
            if (pendingRequestsToMe.length > 0) {
                badge.textContent = pendingRequestsToMe.length;
                badge.style.display = 'inline';
            } else {
                badge.style.display = 'none';
            }
        }

        function renderUserCard(card, userId) {
            const interactions = cardInteractions[card.id] || {likes: [], owns: [], wants: []};
            const userLiked = interactions.likes.includes(userId);
            const userOwns = interactions.owns.includes(userId);
            const userWants = interactions.wants.includes(userId);

            let actionTagsHtml = '<div class="action-tags">';
            if (userLiked) actionTagsHtml += '<span class="action-tag liked">‚ù§Ô∏è Loved</span>';
            if (userOwns) actionTagsHtml += '<span class="action-tag owned">üí™ Owned</span>';
            if (userWants) actionTagsHtml += '<span class="action-tag wanted">ü§≤ Wanted</span>';
            actionTagsHtml += '</div>';

            return `
                <div class="card-item" style="position: relative;">
                    <div class="card-id-badge">#${card.id}</div>
                    <div class="sport-icon">‚öΩ</div>
                    <div class="card-images">
                        <div class="card-image" onclick="openModal('${card.frontImage || ''}')">
                            ${card.frontImage ? `<img src="${card.frontImage}" alt="Front">` : `${card.playerName}<br>FRONT`}
                        </div>
                        <div class="card-image" onclick="openModal('${card.backImage || ''}')">
                            ${card.backImage ? `<img src="${card.backImage}" alt="Back">` : `${card.playerName}<br>BACK`}
                        </div>
                    </div>
                    <div class="card-info">
                        <h3>${card.playerName}</h3>
                        <div class="card-detail"><strong>Team:</strong><span>${card.team} ${card.clubIcon || ''}</span></div>
                        <div class="card-detail"><strong>Type:</strong><span>${card.cardType}</span></div>
                        <div class="card-detail"><strong>Company:</strong><span>${card.company}</span></div>
                        ${card.tags && card.tags.length > 0 ? '<div class="tags">' + card.tags.map(tag => `<span class="tag ${tag.toLowerCase()}">${tag}</span>`).join('') + '</div>' : ''}
                        ${actionTagsHtml}
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
